{% extends "base.html" %}

{% load socialaccount %}

{% block content %}

{% get_social_accounts request.user as accounts %}

<main class="container px-4 lg:px-0 py-8 mx-auto max-w-6xl">
  <div class="bg-white rounded py-8 sm:mt-8 shadow-md  ">
    <div class="px-8 pb-8 border-b border-solid border-gray-300">
        real address: {{ request.user.email }}
    </div>
    <!-- Empty State -->
    <!-- List of Emails -->
    <div class="px-8 mt-8 main-list">
      <table class="table-fixed">
          <thead>
          <tr>
              <th class="w-1/3">Address (Click to copy)</th>
              <th class="w-1/6">Created on</th>
              <th class="w-1/8">Forwarded</th>
              <th class="w-1/8">Blocked</th>
              <th class="w-1/8">Spam</th>
              <th class="w-1/4"></th>
          </tr>
          </thead>
          <tbody>
      {% for relay_address in relay_addresses %}
          <tr class="border">
              <td class="email-meta">
                  <span title="Click to copy" data-clipboard-text="{{ relay_address.address }}@{{ RELAY_DOMAIN }}" class="inline-block w-64 js-copy cursor-pointer truncate ...">{{ relay_address.address }}@{{ RELAY_DOMAIN }}</span>
              </td>
              <td class="email-meta">
                <span class="break-all">{{ relay_address.created_at|date:"N j Y" }}</span>
              </td>
              <td class="email-meta">
                <span class="break-all">{{ relay_address.num_forwarded }}</span>
              </td>
              <td class="email-meta">
                <span class="break-all">{{ relay_address.num_blocked }}</span>
              </td>
              <td class="email-meta">
                <span class="break-all">{{ relay_address.num_spam }}</span>
              </td>
              <td>
                  <form action="{% url 'emails-index' %}" method="POST" class="inline-block">
                      <input type="hidden" name="method_override" value="PUT">
                      <input type="hidden" name="api_token" value="{{ user.profile_set.first.api_token }}">
                      <input type="hidden" name="relay_address_id" value="{{ relay_address.id }}">
                      {% if relay_address.enabled %}
                      <input type="submit" name="enabled" value="Disable" class="text-center inline-block mt-4 md:mt-0 md:ml-4  py-2 px-4 leading-normal rounded border border-solid border-red-800 bg-red-800 hover:bg-red-900 text-white"></input>
                      {% else %}
                      <input type="submit" name="enabled" value="Enable" class="text-center inline-block mt-4 md:mt-0 md:ml-4  py-2 px-4 leading-normal rounded border border-solid border-green-800 bg-green-800 hover:bg-green-900 text-white"></input>
                      {% endif %}
                  </form>
                  <form action="{% url 'emails-index' %}" method="POST" class="inline-block">
                      <input type="hidden" name="method_override" value="DELETE">
                      <input type="hidden" name="api_token" value="{{ user.profile_set.first.api_token }}">
                      <input type="hidden" name="relay_address_id" value="{{ relay_address.id }}">
                      <input type="submit" name="delete" value="Delete Address"class="text-center inline-block mt-4 md:mt-0 md:ml-4  py-2 px-4 leading-normal rounded border border-solid border-red-800 bg-red-800 hover:bg-red-900 text-white"></input>
                  </form>
              </td>
            </tr>
      {% endfor %}
          </tbody>
      </table>
      <div class="md:flex-wrap md:flex md:justify-between md:items-center">
        <div class="generate-button">
          <form action="/emails/" method="POST">
              <input type="hidden" name="api_token" value="{{ user.profile_set.first.api_token }}">
              <input class="md:ml-8 mt-4 md:mt-0 py-2 px-4 bg-transparent cursor-pointer leading-normal rounded border border-solid border-purple-800 text-purple-800 hover:bg-purple-800 hover:text-white" type="submit" value="Generate new relay address">
          </form>
        </div>
      </div>
    </div>
  </div>
</main>

{% endblock %}
